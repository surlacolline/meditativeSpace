<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>JS Drum Kit</title>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <div class="container demo content">
      <div id="large-header" class="large-header">
        <canvas id="demo-canvas"></canvas>
        <div class="main-title">
          <div class="keys">
            <div data-key="81" class="key">
              <kbd>Q</kbd>
            </div>
            <div data-key="83" class="key">
              <kbd>S</kbd>
            </div>
            <div data-key="68" class="key">
              <kbd>D</kbd>
            </div>
            <div data-key="70" class="key">
              <kbd>F</kbd>
            </div>
            <div data-key="71" class="key">
              <kbd>G</kbd>
            </div>
            <div data-key="72" class="key">
              <kbd>H</kbd>
            </div>
            <div data-key="74" class="key">
              <kbd>J</kbd>
            </div>
            <div data-key="75" class="key">
              <kbd>K</kbd>
            </div>
            <div data-key="76" class="key">
              <kbd>L</kbd>
            </div>
            <div data-key="77" class="key">
              <kbd>M</kbd>
            </div>
          </div>

          <div data-key="32" class="key keySpace">
            <kbd>SPACE</kbd>
          </div>
        </div>
      </div>
    </div>

    <audio data-key="81" src="./sounds/Echolight.wav" loop></audio>
    <audio data-key="83" src="./sounds/s1.wav" loop></audio>
    <audio data-key="68" src="./sounds/s2.wav" loop></audio>
    <audio data-key="70" src="./sounds/s3.wav" loop></audio>
    <audio data-key="71" src="./sounds/s4.wav" loop></audio>
    <audio data-key="72" src="./sounds/s5.wav" loop></audio>
    <audio data-key="74" src="./sounds/s6.wav" loop></audio>
    <audio data-key="75" src="./sounds/s7.wav" loop></audio>
    <audio data-key="76" src="./sounds/s8.wav" loop></audio>
    <audio data-key="77" src="./sounds/s9.wav" loop></audio>

    <script>
      function ToggleAudio(keyCode, forceStop = false) {
        let audio = document.querySelector(`audio[data-key="${keyCode}"]`);
        const key = document.querySelector(`.key[data-key="${keyCode}"]`);
        if (!audio) return; // stop the function

        if (audio.currentTime === 0 && !forceStop) {
          key.classList.add("playing");
          audio.play();
        } else {
          audio.pause();
          audio.currentTime = 0;
          audio = undefined;
          key.classList.remove("playing");
        }
      }

      function IsPlaying(keys) {
        for (let i = 0; i < keys.length; i++) {
          let audio = document.querySelector(`audio[data-key="${keys[i].dataset.key}"]`);
     
          if (audio && !(audio.currentTime === 0)) {
            return true;
          }
        }
        return false;
      }
    
      let keySpace = document.querySelector(`.key[data-key="32"]`);
      keySpace.addEventListener("transitionend", RemoveTransition);
      function RemoveTransition(e) {
        console.log(e);
        if (e.propertyName !== "transform") return;
        keySpace.classList.remove("playing");


         


      }

      window.addEventListener("keydown", function (e) {

        if (e.keyCode === 32) {
   
          const keys = document.querySelectorAll(`.key`);
          keySpace.classList.add("playing");
          if (IsPlaying(keys)) {
            keys.forEach((key) => ToggleAudio(key.dataset.key, true));
          } else {
            keys.forEach((key) => ToggleAudio(key.dataset.key));
          }
        } else {
          ToggleAudio(e.keyCode);
        }

      });
    </script>

    <script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/499416/TweenLite.min.js"></script>
    <script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/499416/EasePack.min.js"></script>
    <script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/499416/demo.js"></script>
  </body>
</html>
